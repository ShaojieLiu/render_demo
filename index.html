<!DOCTYPE html>
<html>
    <head>
    <meta name="description" content="艺术字Demo">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>snapSvg</title>
        <style>
            .txt-reflect{
                /*transform-origin: 50% 100%;*/
                -webkit-transform: rotateX(180deg);
            }
            .txt-root{
                -webkit-transform: skewX(60deg) scaleY(0.3);
            }
            .txt-main{
                /*display: none;*/
            }
            .txt-bottom{
                /*display: none;*/
            }
            .txt-shadow{
                /*display: none;*/
            }
            .txt-reflect{
                /*display: none;*/
            }
        </style>
    </head>
    <body>
        <div id="num1-input"></div>
        <txt id="num1"></txt>
        <br><p>以下是测试</p>
        <svg id="svgtest"></svg>

<!--<script src='./lib/snap.svg.js'></script>-->
<script src="https://cdn.bootcss.com/snap.svg/0.5.1/snap.svg-min.js"></script>
<script type="text/javascript">
var e = function(sel) {return document.querySelector(sel)}
var es = function(sel) {return document.querySelectorAll(sel)}
var log = function(...args) {return console.log(...args)}

var txt = function(props) {
    e('#'+props.fatherID).innerHTML += `<svg height="300px" width="300px" id=${props.eleID}></svg>`
    var svg = e(`#${props.eleID}`),
        paper = Snap(`#${props.eleID}`),
        defaultStyle = {
            shadowColor: '#555',
            shadowPosition: ['0.04em', '1.04em'],
            shadowBlur: [1, 1],
            shadowOpacity: 0.5,
            bottomColor: '#fff',
            urlMain: "./img/t10.jpg",
            reflectOpacity: 0,
            rootOpacity: 0,
        },
        styleTypeList = {
            0: {
                shadowOpacity: 0,
                urlMain: './img/t0.jpg',
            },
            1: {
            },
            2: {
                shadowPosition: ['0.0em', '1.0em'],
                shadowBlur: [4, 4], // 这里的 5 指的是 fontSize 的 5% ,详见下面的 shadowF 的定义
                shadowOpacity: 1,
                urlMain: "./img/t11.jpg",
                shadowColor: '#55d',
                reflectOpacity: 1,
            },
            3: {
                shadowPosition: ['0.0em', '1.0em'],
                shadowBlur: [4, 4],
                shadowOpacity: 1,
                urlMain: "./img/t1.jpg",
                shadowColor: '#55d',
                reflectOpacity: 0,
                rootOpacity: 1,
            }
        }


    var style = Object.assign({}, defaultStyle, styleTypeList[props.styleType], props)
    var fontSize = style.fontSize,
        fontFamily = style.fontFamily,
        urlMain = style.urlMain,
        color = style.color
        refY = style.fontSize * (-1.5);
        rootX = style.fontSize * (-1.85);
        rootY = style.fontSize * (2.5);


    var txtShadow = paper.text(...style.shadowPosition, style.content),
        txtReflect = paper.text(0, '-1.15em', style.content),
        txtRoot = paper.text('-1.85em', '3.5em', style.content),
        txtBottom = paper.text(0, '1em', style.content),
        txtMain = paper.text(0, '1em', style.content),
        shadowF = paper.filter(Snap.filter.blur(...style.shadowBlur.map(function(num) {return num * style.fontSize * 0.01}))),
//        rootF = paper.filter(Snap.filter.blur(...style.shadowBlur.map(function(num) {return num * style.fontSize * 0.01}))),
//        shadowF = paper.filter(Snap.filter.shadow(1, 1, 1)),
        url0 = "./img/t0.jpg",
        urlRef = "./img/t11.jpg",
        imgMain = paper.image(urlMain, 0, 0, 1366, 768),
        imgShadow = paper.image(url0, 0, 0, 1366, 768),
        imgBlank = paper.image(url0, 0, 0, 1366, 768),
        imgRoot = paper.image(url0, rootX, rootY, 1366, 768),
        imgReflect = paper.image(urlRef, 0, refY, 1366, 200) // 这些高宽的设置后面会被覆盖

    var mainOptions = {
        class: 'txt-main',
        mask: imgMain,
        fill: color,
        fontSize,
        fontFamily,
    },
    bottomOptions = {
        class: 'txt-bottom',
        mask: imgBlank,
        fill: style.bottomColor,
    },
    shadowOptions = {
        class: 'txt-shadow',
        mask: imgShadow,
        fill: style.shadowColor,
        "fill-opacity": style.shadowOpacity,
        filter: shadowF
    },
    reflectOptions = {
        class: 'txt-reflect',
        mask: imgReflect,
        "fill-opacity": style.reflectOpacity,
    }
    rootOptions = {
        class: 'txt-root',
        mask: imgRoot,
        "fill-opacity": style.rootOpacity,
//        filter: rootF
    }

    var txtOptionsArr = [mainOptions, bottomOptions, reflectOptions, shadowOptions, rootOptions]
    var txtArr = [txtMain, txtBottom, txtReflect, txtShadow, txtRoot]
    txtOptionsArr = txtOptionsArr.map(function(ele) {
        return Object.assign({}, mainOptions, ele)
    })
    txtArr.forEach(function(ele, index) {
        txtArr[index].attr(txtOptionsArr[index])
    })
//    log(txtOptionsArr, txtArr)

    var text = e(`#${props.eleID} text`)
    var imgArr = [imgMain, imgShadow, imgBlank, imgReflect, imgRoot]
    var textHeight = text.style.fontSize.slice(0, -2) * 1.4
    var svgOptions = {
        width: text.clientWidth + 'px',
        height: textHeight * props.lineHeight + 'px',
    }
    var imgOptions = {
        width: text.clientWidth,
        height: textHeight,
    }
//    svg.style.width = '200px'
    svg.style.width = svgOptions.width
    svg.style.height = svgOptions.height
    imgArr.forEach(function(ele) {ele.attr(imgOptions)})
}
var render = function(obj) {
    InputdefaultOptionsNum1.fatherID = 'num1'
    options = Object.assign({}, InputdefaultOptionsNum1, obj)
    e('#num1').innerHTML = ``
    txt(Object.assign({}, options, {eleID: 'num1-txt1',styleType: 0}))
    txt(Object.assign({}, options, {eleID: 'num1-txt2',styleType: 1}))
    txt(Object.assign({}, options, {eleID: 'num1-txt3',styleType: 2}))
    txt(Object.assign({}, options, {eleID: 'num1-txt4',styleType: 3}))
}

var bindAll = function() {
    var ele = e('#num1-input')
    ele.addEventListener('input', function() {
        var obj = {}
        es('#num1-input input').forEach(function(ele) {
            if ('' !== ele.value) {
                obj[ele.name] = ele.value
            }
        })
        render(obj)
    })
}

var svgTest = function() {
    var s = Snap("#svgtest")
    var text = s.text(0, '1em', 'qweasd')
    var imgMain = s.image('./img/t10.jpg', 0, 0, 1366, 768)
    text.attr({mask: imgMain, fill: '#35f'})
}

var inputInit = function(fatherID) {
    var father = e('#'+fatherID)
    var optionsArr = [
        {name: 'content',       defaultValue: "艺术字"},
        {name: 'styleType',     defaultValue: "0"},
        {name: 'color',         defaultValue: "#55d"},
        'br',
        {name: 'fontFamily',    defaultValue: "default", bzvu: 'eg: Times New Roman, Georgia, Serif'},
        'br',
        {name: 'fontSize',      defaultValue: "66"},
        {name: 'lineHeight',    defaultValue: "1.0"},
    ]
    var templateArr = optionsArr.map(function(ele) {
        if(ele === 'br') {
            return `<br>`
        } else {
            var name = ele.name,
                defaultValue = ele.defaultValue,
                bzvu = ele.bzvu
            //language=HTML
            var t = `<span>${name}: </span>
                <input name=${name} type="text" placeholder=${defaultValue}>
                <span>${bzvu || ''}</span>`
            return t
        }
    })
    father.innerHTML += templateArr.join('\n')
    var optionsObj = {}
    optionsArr.forEach(function(ele) {
        if ('br' !== ele) {optionsObj[ele.name] = ele.defaultValue}
    })
    return optionsObj
}

var __main = function() {
    window.InputdefaultOptionsNum1 = inputInit('num1-input')
    render()
    bindAll()
    svgTest()
}

__main()

</script>
    </body>
</html>
